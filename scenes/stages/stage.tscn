[gd_scene load_steps=14 format=3 uid="uid://2stxk6mbvwbv"]

[ext_resource type="Script" path="res://scripts/main/stage.gd" id="1_u513e"]
[ext_resource type="Environment" uid="uid://cb3w11r233fne" path="res://components/lightkeepers_environment.tres" id="2_2wtx5"]
[ext_resource type="Script" path="res://scripts/main/stage_manager.gd" id="2_top5x"]
[ext_resource type="Script" path="res://scripts/main/turn_manager.gd" id="3_xxwxp"]
[ext_resource type="Resource" uid="uid://bhavpgvghw8tl" path="res://scenes/stages/stage_schedules/first_stage.tres" id="5_in44l"]
[ext_resource type="TileSet" uid="uid://b4eq1ur4r1nxo" path="res://components/tilesets/default_tileset.tres" id="6_gjeh3"]
[ext_resource type="Texture2D" uid="uid://cvxpar4w3yb3t" path="res://assets/prototypes/neutral_point_2d.webp" id="8_txpjo"]
[ext_resource type="Script" path="res://scripts/controls/detection_ray.gd" id="9_fgewh"]
[ext_resource type="PackedScene" uid="uid://4cpjktoig8qa" path="res://components/systems/light_area_component.tscn" id="11_x4sy4"]
[ext_resource type="PackedScene" uid="uid://5si7n88ll4im" path="res://components/systems/mouse_light.tscn" id="12_oob5i"]
[ext_resource type="PackedScene" uid="uid://duxknnynvh60n" path="res://scenes/stage_camera.tscn" id="13_ggfcb"]

[sub_resource type="CameraAttributesPractical" id="CameraAttributesPractical_2unhy"]

[sub_resource type="Curve2D" id="Curve2D_v06dm"]

[node name="StageZero" type="Node2D" node_paths=PackedStringArray("modulate_layer") groups=["stage"]]
process_mode = 3
script = ExtResource("1_u513e")
modulate_layer = NodePath("StageEffects/DarknessLayer")
check_coordinate = true
stage_songs = Array[String](["Active SL2024-08-07"])
metadata/_edit_horizontal_guides_ = [360.0, -192.0, 896.0]

[node name="StageEffects" type="Node" parent="."]

[node name="WorldEnvironment" type="WorldEnvironment" parent="StageEffects"]
environment = ExtResource("2_2wtx5")
camera_attributes = SubResource("CameraAttributesPractical_2unhy")

[node name="BackgroundParallax" type="ParallaxBackground" parent="StageEffects"]
visible = false

[node name="StaticBG" type="ParallaxLayer" parent="StageEffects/BackgroundParallax"]
motion_mirroring = Vector2(2560, 1440)

[node name="ColorRect" type="ColorRect" parent="StageEffects/BackgroundParallax/StaticBG"]
custom_minimum_size = Vector2(2560, 1440)
offset_left = -30.0
offset_top = -88.0
offset_right = 2530.0
offset_bottom = 1352.0
color = Color(0, 0, 0, 1)

[node name="PlaceholderEffectLayer" parent="StageEffects" instance_placeholder="res://scenes/ui/ui_screen_effect_layer.tscn"]

[node name="DarknessLayer" type="CanvasModulate" parent="StageEffects"]
visible = false
color = Color(0.0885601, 0.08856, 0.0885589, 1)

[node name="StageAgent" type="Node" parent="."]
script = ExtResource("2_top5x")
initial_coins = 60000

[node name="TurnManager" type="Node" parent="StageAgent" node_paths=PackedStringArray("enemy_spawn_point")]
process_mode = 1
script = ExtResource("3_xxwxp")
turn_schedule = ExtResource("5_in44l")
enemy_spawn_point = NodePath("../../Containers/SpawnPosition")
infinite = true

[node name="SpawnTimer" type="Timer" parent="StageAgent/TurnManager"]
process_mode = 1
process_callback = 0
one_shot = true

[node name="TurnTimer" type="Timer" parent="StageAgent/TurnManager"]
process_mode = 1
process_callback = 0
one_shot = true

[node name="GroundLayer" type="TileMapLayer" parent="."]
use_parent_material = true
tile_set = ExtResource("6_gjeh3")

[node name="ObjectLayer" type="TileMapLayer" parent="."]
modulate = Color(2, 2, 2, 1)
z_index = 25
use_parent_material = true
tile_set = ExtResource("6_gjeh3")

[node name="InteractionLayer" type="TileMapLayer" parent="."]
z_index = 10
use_parent_material = true
tile_set = ExtResource("6_gjeh3")
navigation_enabled = false

[node name="ForegroundLayer" type="TileMapLayer" parent="."]
z_index = 5
use_parent_material = true
tile_set = ExtResource("6_gjeh3")
navigation_enabled = false

[node name="NexusRef" type="Marker2D" parent="." groups=["nexus"]]
position = Vector2(872, 360)

[node name="CenterGlow" type="PointLight2D" parent="NexusRef"]
color = Color(0.975347, 0.694582, 0.170898, 1)
energy = 2.0
range_item_cull_mask = 7
shadow_enabled = true
shadow_color = Color(0, 0, 0, 0.486275)
shadow_item_cull_mask = 6
texture = ExtResource("8_txpjo")
height = 100.0

[node name="WideGlow" type="PointLight2D" parent="NexusRef/CenterGlow"]
color = Color(0.696348, 0.713585, 0.543851, 1)
energy = 0.5
texture = ExtResource("8_txpjo")
texture_scale = 3.0

[node name="CenterSubtract" type="PointLight2D" parent="NexusRef/CenterGlow"]
scale = Vector2(0.361328, 0.361328)
color = Color(0.975347, 0.694582, 0.170898, 1)
blend_mode = 1
range_item_cull_mask = 7
shadow_enabled = true
shadow_color = Color(0, 0, 0, 0.486275)
shadow_item_cull_mask = 6
texture = ExtResource("8_txpjo")
height = 100.0

[node name="NexusRaycast" type="RayCast2D" parent="NexusRef"]
visible = false
target_position = Vector2(0, 0)
collision_mask = 5
script = ExtResource("9_fgewh")

[node name="NexusRayLine" type="Line2D" parent="NexusRef/NexusRaycast"]
position = Vector2(-609, -144)
points = PackedVector2Array(609, 144, 609, 144)
width = 5.0

[node name="LightAreaComponent" parent="." instance=ExtResource("11_x4sy4")]

[node name="MouseLight" parent="LightAreaComponent" groups=["mouse_light"] instance=ExtResource("12_oob5i")]
shadow_enabled = false

[node name="Containers" type="Node2D" parent="."]
process_mode = 1

[node name="SpawnPosition" type="Marker2D" parent="Containers"]
position = Vector2(32, 360)

[node name="SpawnGlow" type="PointLight2D" parent="Containers/SpawnPosition"]
color = Color(0.533483, 1.8049e-07, 0.135244, 1)
energy = 3.0
range_item_cull_mask = 7
shadow_enabled = true
shadow_color = Color(0, 0, 0, 0.486275)
shadow_item_cull_mask = 6
texture = ExtResource("8_txpjo")
texture_scale = 0.5
height = 100.0

[node name="EntityContainer" type="Node2D" parent="Containers" groups=["entity_container"]]

[node name="ObjectContainer" type="Node2D" parent="Containers" groups=["tower_container"]]

[node name="ProjectileContainer" type="Node2D" parent="Containers" groups=["projectile_container"]]

[node name="StagePath" type="Path2D" parent="."]
curve = SubResource("Curve2D_v06dm")

[node name="StageCamera" parent="." instance=ExtResource("13_ggfcb")]
position = Vector2(640, 360)
limit_smoothed = false
min_zoom = 0.5

[connection signal="health_updated" from="StageAgent" to="StageAgent" method="_on_health_updated"]
[connection signal="schedule_finished" from="StageAgent/TurnManager" to="StageAgent/TurnManager" method="_on_schedule_finished"]
